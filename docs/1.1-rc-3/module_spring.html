<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0">
<meta name="author" content="Peter Niederwieser">
<title>Spring Module</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
</head>
<body class="article">
<div id="header">
<h1>Spring Module</h1>
<div class="details">
<span id="author" class="author">Peter Niederwieser</span><br>
<span id="revnumber">version 1.1-rc3</span>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The Spring module enables integration with <a href="http://docs.spring.io/spring/docs/4.1.5.RELEASE/spring-framework-reference/html/testing.html#testcontext-framework">Spring TestContext Framework</a>.
It supports the following spring annotations <code>@ContextConfiguration</code> and <code>@ContextHierarchy</code>. Furthermore, it supports the meta-annotation <code>@BootstrapWith</code> and so any annotation that is annotated with <code>@BootstrapWith</code> will also work, such as <code>@SpringBootTest</code>, <code>@WebMvcTest</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mocks">Mocks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spock 1.1 introduced the <code>DetachedMockFactory</code> and the <code>SpockMockFactoryBean</code> which allow the creation of Spock mocks outside of a specification.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Although the mocks can be created outside of a specification,
they only work inside the scope of a specification. So don&#8217;t perform any actions on them until they are attached to one.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_java_config">Java Config</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">public</span> <span class="type">class</span> <span class="class">DetachedJavaConfig</span> {
  <span class="keyword">def</span> mockFactory = <span class="keyword">new</span> DetachedMockFactory()

  <span class="annotation">@Bean</span>
  GreeterService serviceMock() {
    <span class="keyword">return</span> mockFactory.Mock(GreeterService)
  }

  <span class="annotation">@Bean</span>
  GreeterService serviceStub() {
    <span class="keyword">return</span> mockFactory.Stub(GreeterService)
  }

  <span class="annotation">@Bean</span>
  GreeterService serviceSpy() {
    <span class="keyword">return</span> mockFactory.Spy(GreeterServiceImpl)
  }

  <span class="annotation">@Bean</span>
  FactoryBean&lt;GreeterService&gt; alternativeMock() {
    <span class="keyword">return</span> <span class="keyword">new</span> SpockMockFactoryBean(GreeterService)
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xml">XML</h3>
<div class="paragraph">
<p>Spock has spring namespace support, so if you declare the spock namespace with <code>xmlns:spock="http://www.spockframework.org/spring"</code> you get access to the convenience functions for creating mocks.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:spock</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.spockframework.org/spring</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
           <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
           <span class="content">http://www.spockframework.org/spring http://www.spockframework.org/spring/spock.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;spock:mock</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceMock</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework.spring.docs.GreeterService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>   <b class="conum">(1)</b>
  <span class="tag">&lt;spock:stub</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceStub</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework.spring.docs.GreeterService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>   <b class="conum">(2)</b>
  <span class="tag">&lt;spock:spy</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serviceSpy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework.spring.docs.GreeterServiceImpl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <b class="conum">(3)</b>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">alternativeMock</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework.spring.xml.SpockMockFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> <b class="conum">(4)</b>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.spockframework.spring.docs.GreeterService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mockNature</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MOCK</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>                                           <b class="conum">(5)</b>
  <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Creates a <code>Mock</code></p>
</li>
<li>
<p>Creates a <code>Stub</code></p>
</li>
<li>
<p>Creates a <code>Spy</code></p>
</li>
<li>
<p>If you don&#8217;t want to use the special namespace support you can create the beans via the <code>SpockMockFactoryBean</code></p>
</li>
<li>
<p>The <code>mockNature</code> can be <code>MOCK</code>, <code>STUB</code>, or <code>SPY</code> and defaults to <code>MOCK</code> if not declared.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_usage">Usage</h3>
<div class="paragraph">
<p>To use the mocks just inject them like any other bean and configure them as usual.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Autowired</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">'</span><span class="content">serviceMock</span><span class="delimiter">'</span></span>)
GreeterService serviceMock

<span class="annotation">@Autowired</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">'</span><span class="content">serviceStub</span><span class="delimiter">'</span></span>)
GreeterService serviceStub

<span class="annotation">@Autowired</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">'</span><span class="content">serviceSpy</span><span class="delimiter">'</span></span>)
GreeterService serviceSpy

<span class="annotation">@Autowired</span> <span class="annotation">@Named</span>(<span class="string"><span class="delimiter">'</span><span class="content">alternativeMock</span><span class="delimiter">'</span></span>)
GreeterService alternativeMock

<span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">mock service</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">when</span>:
  <span class="keyword">def</span> result = serviceMock.greeting

  <span class="key">then</span>:
  result == <span class="string"><span class="delimiter">'</span><span class="content">mock me</span><span class="delimiter">'</span></span>
  <span class="integer">1</span> * serviceMock.getGreeting() &gt;&gt; <span class="string"><span class="delimiter">'</span><span class="content">mock me</span><span class="delimiter">'</span></span>
}

<span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">sub service</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">given</span>:
  serviceStub.getGreeting() &gt;&gt; <span class="string"><span class="delimiter">'</span><span class="content">stub me</span><span class="delimiter">'</span></span>

  <span class="key">expect</span>:
  serviceStub.greeting == <span class="string"><span class="delimiter">'</span><span class="content">stub me</span><span class="delimiter">'</span></span>
}

<span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">spy service</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">when</span>:
  <span class="keyword">def</span> result = serviceSpy.greeting

  <span class="key">then</span>:
  result == <span class="string"><span class="delimiter">'</span><span class="content">Hello World</span><span class="delimiter">'</span></span>
  <span class="integer">1</span> * serviceSpy.getGreeting()
}

<span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">alternatice mock service</span><span class="delimiter">&quot;</span></span>() {
  <span class="key">when</span>:
  <span class="keyword">def</span> result = alternativeMock.greeting

  <span class="key">then</span>:
  result == <span class="string"><span class="delimiter">'</span><span class="content">mock me</span><span class="delimiter">'</span></span>
  <span class="integer">1</span> * alternativeMock.getGreeting() &gt;&gt; <span class="string"><span class="delimiter">'</span><span class="content">mock me</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot">Spring Boot</h3>
<div class="paragraph">
<p>The recommended way to use Spock mocks in <code>@WebMvcTest</code> tests, is to use an embedded config annotated with <code>@TestConfiguration</code> and to create the mocks using the <code>DetachedMockFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@WebMvcTest</span>
<span class="type">class</span> <span class="class">WebMvcTestIntegrationSpec</span> <span class="directive">extends</span> Specification {

  <span class="annotation">@Autowired</span>
  MockMvc mvc

  <span class="annotation">@Autowired</span>
  HelloWorldService helloWorldService

  <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">spring context loads for web mvc slice</span><span class="delimiter">&quot;</span></span>() {
    <span class="key">given</span>:
    helloWorldService.getHelloMessage() &gt;&gt; <span class="string"><span class="delimiter">'</span><span class="content">hello world</span><span class="delimiter">'</span></span>

    <span class="key">expect</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">controller is available</span><span class="delimiter">&quot;</span></span>
    mvc.perform(MockMvcRequestBuilders.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>))
      .andExpect(status().isOk())
      .andExpect(content().string(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span>))
  }

  <span class="annotation">@TestConfiguration</span>
  <span class="directive">static</span> <span class="type">class</span> <span class="class">MockConfig</span> {
    <span class="keyword">def</span> detachedMockFactory = <span class="keyword">new</span> DetachedMockFactory();

    <span class="annotation">@Bean</span>
    HelloWorldService helloWorldService() {
      <span class="keyword">return</span> detachedMockFactory.Stub(HelloWorldService)
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more examples see the specs in the <a href="https://github.com/spockframework/spock/tree/master/spock-spring/src/test/groovy/org/spockframework/spring">codebase</a> and <a href="https://github.com/spockframework/spock/tree/master/spock-spring/src/test/groovy/org/spockframework/spring/boot-test">boot examples</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1-rc3<br>
Last updated 2016-11-07 06:20:27 -08:00
</div>
</div>
</body>
</html>